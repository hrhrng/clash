name = "loro-sync-server"
main = "src/index.ts"
compatibility_date = "2024-11-20"
compatibility_flags = ["nodejs_compat"]

# Enable Workers Observability for Logpush
[observability]
enabled = true
head_sampling_rate = 1  # 100% sampling for dev, reduce in production

# Durable Objects bindings
[[durable_objects.bindings]]
name = "LORO_ROOM"
class_name = "LoroRoom"

[[durable_objects.bindings]]
name = "TASK_DO"
class_name = "TaskDO"

[[d1_databases]]
binding = "DB"
database_name = "master-clash-frontend"
database_id = "aab16eeb-a375-490b-ad1e-cd092cd9f4bb"

# R2 bucket for generated assets (remote in local dev)
[[r2_buckets]]
binding = "ASSETS"
bucket_name = "master-clash-assets"
remote = true

# Environment variables
[vars]
BETTER_AUTH_BASE_PATH = "/api/better-auth"

# Development environment
[env.development]
vars = { ENVIRONMENT = "development" }

# Production environment
[env.production]
vars = { ENVIRONMENT = "production" }

# Durable Object migrations
[[migrations]]
tag = "v1"
new_classes = ["LoroRoom"]

[[migrations]]
tag = "v2"
new_classes = ["TaskDO"]
